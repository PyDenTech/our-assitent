version: 1.0
runtime: nodejs20

build:
  commands:
    - npm ci --omit=dev

run:
  command: node server.js
  network:
    port: 3001
  env:
    - name: NODE_ENV
      value: production
    - name: PORT
      value: "3001"
    - name: FRONTEND_URL
      value: "https://ourassistent.pydentech.com" # dom√≠nio do frontend (Amplify)
    - name: JWT_SECRET
      value: "${JWT_SECRET}" # configure o valor real direto no console do App Runner
    - name: GOOGLE_CLIENT_ID
      value: "${GOOGLE_CLIENT_ID}" # configure no ambiente AWS
    - name: GOOGLE_CLIENT_SECRET
      value: "${GOOGLE_CLIENT_SECRET}" # configure no ambiente AWS
    - name: GOOGLE_REDIRECT_URI
      value: "https://api.ourassistent.pydentech.com/auth/google/callback"

healthcheck:
  path: /health
  interval: 10 # segundos
  timeout: 5
  healthyThreshold: 1
  unhealthyThreshold: 5

autoDeploymentsEnabled: true
cpu: 1 vCPU
memory: 2 GB
